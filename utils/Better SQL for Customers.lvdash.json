{
  "datasets": [
    {
      "name": "e4caf283",
      "displayName": "sql_notebooks",
      "query": "select '/?o='||A.workspace_id||'#notebook/'||A.notebookId as notebookURL, \nround(A.sql_percentage*100.,1) sql_percentage, \n'<a target=\"_blank\" href=\"/?o='||A.workspace_id||'#notebook/'||A.notebookId||'\">'||B.path||'</a>' as notebookPath,\n       \nA.* except(sql_percentage)\nfrom\n(\n  SELECT workspace_id,\n        request_params.notebookId,\n        request_params.clusterId,\n        '<a target=\"_blank\" href=\"/compute/clusters/'||request_params.clusterId||'?o='||workspace_id||'\">'||request_params.clusterId||'</a>' as cluster_url,\n       \n        count(1) as total_command_execution,\n        count_if(request_params.commandLanguage = 'sql') as sql_command_execution,\n        count_if(request_params.commandLanguage <> 'sql') as non_sql_command_execution,\n        sql_command_execution/total_command_execution as sql_percentage\n  FROM system.access.audit\n  WHERE \n  service_name = 'notebook'\n  and action_name = 'runCommand'\n  and event_date > '2024-07-10'\n  group by workspace_id, request_params.notebookId, request_params.clusterId) A\njoin\n(\n  SELECT distinct workspace_id,\n        request_params.notebookId,\n        request_params.clusterId,\n        request_params.path\n  FROM system.access.audit\n  WHERE \n  service_name = 'notebook'\n  and action_name = 'attachNotebook'\n  and event_date > '2024-07-10') B\non A.clusterId=B.clusterId and A.workspace_id=B.workspace_id and A.notebookId=B.notebookId\nwhere contains(A.clusterId, '-')\norder by sql_percentage desc\nlimit 100"
    },
    {
      "name": "30567c7e",
      "displayName": "sql_clusters",
      "query": "-- List of clusters with the highest SQL commands and DBI usage over the last 30 days\nWITH sql_clusters as (\n    SELECT a.workspace_id,\n        request_params.clusterId,\n        count(1) as commands,\n        count_if(request_params.commandLanguage = 'sql') as sql_commands,\n        -- count_if(request_params.commandLanguage <> 'sql') as non_sql_commands,\n        round(sql_commands/commands*100.,1) as sql_percentage,\n        u.dbus\n    FROM system.access.audit a\n    JOIN  system.compute.clusters c \n    ON c.delete_time is NULL \n    AND a.request_params.clusterId = c.cluster_id \n    AND a.workspace_id = c.workspace_id\n    LEFT OUTER JOIN (\n        select usage_metadata.cluster_id, sum(usage_quantity) dbus\n        from system.billing.usage\n        WHERE usage_date > date_sub(now(), 30)\n        GROUP BY ALL) u ON a.request_params.clusterId = u.cluster_id\n    WHERE \n    a.event_date > date_sub(now(), 30)\n    and a.service_name = 'notebook'\n    and a.action_name = 'runCommand'\n    and contains(a.request_params.clusterId, '-')\n    GROUP BY a.workspace_id, request_params.clusterId, c.cluster_source, u.dbus\n    HAVING sql_percentage >= 90.0\n    ORDER BY sql_percentage DESC\n    LIMIT 100\n),\ncurrent_clusters AS (\n  SELECT \n    cs.cluster_id,\n    cluster_name,\n    '<a target=\"_blank\" href=\"/compute/clusters/'||cluster_id||'?o='||workspace_id||'\">'||cluster_name||'</a>' as cluster_link,\n    cs.cluster_source,\n    cs.dbr_version,\n    cs.owned_by,\n    RANK() OVER (PARTITION BY cluster_id ORDER BY change_time DESC) AS rank\n  FROM system.compute.clusters cs\n)\nSELECT\n  sc.workspace_id,\n  sc.clusterId,\n  cc.cluster_name,\n  cc.cluster_link,\n  cc.cluster_source,\n  cc.dbr_version,\n  cc.owned_by,\n  sc.commands,\n  sc.sql_commands,\n  sc.sql_percentage,\n  sc.dbus,\n  sc.dbus * :interactive_dbu_cost as interactive_dollar_dbus,\n  sc.dbus * :dbsql_cost as dbsql_dollar_dbus\nFROM sql_clusters sc\nJOIN current_clusters cc ON sc.clusterId = cc.cluster_id AND cc.rank = 1\nORDER BY sql_percentage*dbus DESC",
      "parameters": [
        {
          "displayName": "interactive_dbu_cost",
          "keyword": "interactive_dbu_cost",
          "dataType": "DECIMAL",
          "defaultSelection": {
            "values": {
              "dataType": "DECIMAL",
              "values": [
                {
                  "value": "1.3"
                }
              ]
            }
          }
        },
        {
          "displayName": "dbsql_cost",
          "keyword": "dbsql_cost",
          "dataType": "DECIMAL",
          "defaultSelection": {
            "values": {
              "dataType": "DECIMAL",
              "values": [
                {
                  "value": "0.7"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "20d751a8",
      "displayName": "bi_tools",
      "query": "WITH ranked_clusters AS (\n  SELECT \n    cs.cluster_id,\n    '<a target=\"_blank\" href=\"/compute/clusters/'||cluster_id||'?o='||workspace_id||'\">'||cluster_name||'</a>' as cluster_name,\n    cs.cluster_source,\n    cs.dbr_version,\n    cs.owned_by,\n    RANK() OVER (PARTITION BY cluster_id ORDER BY change_time DESC) AS rank\n  FROM system.compute.clusters cs\n)\nSELECT\n       sum(u.usage_quantity) AS usage_quantity,\n       count(1) AS count,\n       trim(split(a.user_agent, '/')[0]) AS user_agent,\n       a.request_params.clusterId,\n       rc.cluster_name\n       --collect_list(distinct left(source_ip_address,10)) AS source_ip_addresses\nFROM system.access.audit a\nLEFT OUTER JOIN system.billing.usage u \n  ON a.request_params.clusterId = u.usage_metadata.cluster_id\nLEFT OUTER JOIN ranked_clusters rc\n  ON rc.cluster_id = a.request_params.clusterId\nWHERE a.user_agent NOT LIKE 'databricks-%'\nAND split(user_agent, '/')[0] NOT IN ('armeria', 'Mozilla', 'Apache-HttpClient', 'mlflow-python-client', 'dbdemos', 'python-urllib3', 'unknown','grpc-python','brickster', 'curl', 'python-requests', 'cli')\nAND event_date > '2024-06-01'\nAND request_params.clusterId is not null\nAND action_name = 'createResult'\nGROUP BY ALL\nHAVING usage_quantity > 0\nORDER BY 2 DESC"
    },
    {
      "name": "4bcebe89",
      "displayName": "cluster_utilization",
      "query": "-- 30 day compute utilization\nWITH \ncurrent_clusters AS (\n  SELECT \n    cs.cluster_id,\n    '<a target=\"_blank\" href=\"/compute/clusters/'||cluster_id||'?o='||workspace_id||'\">'||cluster_name||'</a>' as cluster_name,\n    cs.cluster_source,\n    cs.dbr_version,\n    cs.owned_by,\n    RANK() OVER (PARTITION BY cluster_id ORDER BY change_time DESC) AS rank\n  FROM system.compute.clusters cs\n)\nSELECT\ncc.cluster_id,\ncc.cluster_name,\navg(cpu_user_percent + cpu_system_percent) as `Avg CPU Utilization`,\nmax(cpu_user_percent + cpu_system_percent) as `Peak CPU Utilization`,\navg(cpu_wait_percent) as `Avg CPU Wait`,\nmax(cpu_wait_percent) as `Max CPU Wait`,\navg(mem_used_percent) as `Avg Memory Utilization`,\nmax(mem_used_percent) as `Max Memory Utilization`,\navg(network_received_bytes)/(1024^2) as `Avg Network MB Received per Minute`,\navg(network_sent_bytes)/(1024^2) as `Avg Network MB Sent per Minute`\nFROM\nsystem.compute.node_timeline nt\nJOIN current_clusters cc ON nt.cluster_id = cc.cluster_id\nWHERE\n    nt.start_time >= date_add(now(), -30)\nGROUP BY ALL\nORDER BY 3 desc;"
    }
  ],
  "pages": [
    {
      "name": "ab6f6bd7",
      "displayName": "New Page",
      "layout": [
        {
          "widget": {
            "name": "81978477",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "e4caf283",
                  "fields": [
                    {
                      "name": "sql_percentage",
                      "expression": "`sql_percentage`"
                    },
                    {
                      "name": "notebookPath",
                      "expression": "`notebookPath`"
                    },
                    {
                      "name": "clusterId",
                      "expression": "`clusterId`"
                    },
                    {
                      "name": "cluster_url",
                      "expression": "`cluster_url`"
                    },
                    {
                      "name": "workspace_id",
                      "expression": "`workspace_id`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 1,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "sql_percentage",
                    "numberFormat": "%0.0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "float",
                    "displayAs": "number",
                    "visible": true,
                    "order": 0,
                    "title": "sql %",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "description": "SQL commands vs. Total Commands",
                    "displayName": "sql_percentage"
                  },
                  {
                    "fieldName": "notebookPath",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 1,
                    "title": "notebookPath",
                    "allowSearch": true,
                    "alignContent": "left",
                    "allowHTML": true,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "defaultColumnWidth": 400,
                    "displayName": "notebookPath"
                  },
                  {
                    "fieldName": "clusterId",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": false,
                    "order": 4,
                    "title": "clusterId",
                    "allowSearch": true,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "clusterId"
                  },
                  {
                    "fieldName": "cluster_url",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 8,
                    "title": "cluster_url",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": true,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "cluster_url"
                  },
                  {
                    "fieldName": "workspace_id",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 9,
                    "title": "workspace_id",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "workspace_id"
                  }
                ]
              },
              "invisibleColumns": [
                {
                  "booleanValues": [
                    "false",
                    "true"
                  ],
                  "imageUrlTemplate": "{{ @ }}",
                  "imageTitleTemplate": "{{ @ }}",
                  "imageWidth": "",
                  "imageHeight": "",
                  "linkUrlTemplate": "{{ @ }}",
                  "linkTextTemplate": "{{ @ }}",
                  "linkTitleTemplate": "{{ @ }}",
                  "linkOpenInNewTab": true,
                  "name": "notebookURL",
                  "type": "string",
                  "displayAs": "link",
                  "order": 2,
                  "title": "notebookURL",
                  "allowSearch": false,
                  "alignContent": "left",
                  "allowHTML": false,
                  "highlightLinks": false,
                  "useMonospaceFont": false,
                  "preserveWhitespace": false,
                  "description": "Notebook Link"
                },
                {
                  "booleanValues": [
                    "false",
                    "true"
                  ],
                  "imageUrlTemplate": "{{ @ }}",
                  "imageTitleTemplate": "{{ @ }}",
                  "imageWidth": "",
                  "imageHeight": "",
                  "linkUrlTemplate": "{{ @ }}",
                  "linkTextTemplate": "{{ @ }}",
                  "linkTitleTemplate": "{{ @ }}",
                  "linkOpenInNewTab": true,
                  "name": "notebookId",
                  "type": "string",
                  "displayAs": "string",
                  "order": 3,
                  "title": "notebookId",
                  "allowSearch": false,
                  "alignContent": "left",
                  "allowHTML": false,
                  "highlightLinks": false,
                  "useMonospaceFont": false,
                  "preserveWhitespace": false
                },
                {
                  "numberFormat": "0",
                  "booleanValues": [
                    "false",
                    "true"
                  ],
                  "imageUrlTemplate": "{{ @ }}",
                  "imageTitleTemplate": "{{ @ }}",
                  "imageWidth": "",
                  "imageHeight": "",
                  "linkUrlTemplate": "{{ @ }}",
                  "linkTextTemplate": "{{ @ }}",
                  "linkTitleTemplate": "{{ @ }}",
                  "linkOpenInNewTab": true,
                  "name": "total_command_execution",
                  "type": "integer",
                  "displayAs": "number",
                  "order": 5,
                  "title": "total_command_execution",
                  "allowSearch": false,
                  "alignContent": "right",
                  "allowHTML": false,
                  "highlightLinks": false,
                  "useMonospaceFont": false,
                  "preserveWhitespace": false
                },
                {
                  "numberFormat": "0",
                  "booleanValues": [
                    "false",
                    "true"
                  ],
                  "imageUrlTemplate": "{{ @ }}",
                  "imageTitleTemplate": "{{ @ }}",
                  "imageWidth": "",
                  "imageHeight": "",
                  "linkUrlTemplate": "{{ @ }}",
                  "linkTextTemplate": "{{ @ }}",
                  "linkTitleTemplate": "{{ @ }}",
                  "linkOpenInNewTab": true,
                  "name": "sql_command_execution",
                  "type": "integer",
                  "displayAs": "number",
                  "order": 6,
                  "title": "sql_command_execution",
                  "allowSearch": false,
                  "alignContent": "right",
                  "allowHTML": false,
                  "highlightLinks": false,
                  "useMonospaceFont": false,
                  "preserveWhitespace": false
                },
                {
                  "numberFormat": "0",
                  "booleanValues": [
                    "false",
                    "true"
                  ],
                  "imageUrlTemplate": "{{ @ }}",
                  "imageTitleTemplate": "{{ @ }}",
                  "imageWidth": "",
                  "imageHeight": "",
                  "linkUrlTemplate": "{{ @ }}",
                  "linkTextTemplate": "{{ @ }}",
                  "linkTitleTemplate": "{{ @ }}",
                  "linkOpenInNewTab": true,
                  "name": "non_sql_command_execution",
                  "type": "integer",
                  "displayAs": "number",
                  "order": 7,
                  "title": "non_sql_command_execution",
                  "allowSearch": false,
                  "alignContent": "right",
                  "allowHTML": false,
                  "highlightLinks": false,
                  "useMonospaceFont": false,
                  "preserveWhitespace": false
                }
              ],
              "allowHTMLByDefault": false,
              "itemsPerPage": 50,
              "paginationSize": "default",
              "condensed": true,
              "withRowNumber": false,
              "frame": {
                "showTitle": true,
                "title": "SQL notebooks"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 27,
            "width": 6,
            "height": 8
          }
        },
        {
          "widget": {
            "name": "4d3ae174",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "30567c7e",
                  "fields": [
                    {
                      "name": "dbus",
                      "expression": "`dbus`"
                    },
                    {
                      "name": "sql_percentage",
                      "expression": "`sql_percentage`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "clusterId",
                      "expression": "`clusterId`"
                    },
                    {
                      "name": "dbr_version",
                      "expression": "`dbr_version`"
                    },
                    {
                      "name": "owned_by",
                      "expression": "`owned_by`"
                    },
                    {
                      "name": "cluster_source",
                      "expression": "`cluster_source`"
                    },
                    {
                      "name": "commands",
                      "expression": "`commands`"
                    },
                    {
                      "name": "sql_commands",
                      "expression": "`sql_commands`"
                    },
                    {
                      "name": "workspace_id",
                      "expression": "`workspace_id`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 1,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "dbus",
                    "numberFormat": "0,000",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "decimal",
                    "displayAs": "number",
                    "visible": true,
                    "order": 0,
                    "title": "dbus",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "dbus"
                  },
                  {
                    "fieldName": "sql_percentage",
                    "numberFormat": "0.00",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "float",
                    "displayAs": "number",
                    "visible": true,
                    "order": 1,
                    "title": "sql %",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "sql_percentage"
                  },
                  {
                    "fieldName": "cluster_name",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 2,
                    "title": "cluster_name",
                    "allowSearch": true,
                    "alignContent": "left",
                    "allowHTML": true,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "defaultColumnWidth": 200,
                    "displayName": "cluster_name"
                  },
                  {
                    "fieldName": "clusterId",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": false,
                    "order": 3,
                    "title": "clusterId",
                    "allowSearch": true,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "clusterId"
                  },
                  {
                    "fieldName": "dbr_version",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 4,
                    "title": "dbr_version",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": true,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "defaultColumnWidth": 180,
                    "displayName": "dbr_version"
                  },
                  {
                    "fieldName": "owned_by",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 5,
                    "title": "owned_by",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "owned_by"
                  },
                  {
                    "fieldName": "cluster_source",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 6,
                    "title": "cluster src",
                    "allowSearch": false,
                    "alignContent": "center",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "cluster_source"
                  },
                  {
                    "fieldName": "commands",
                    "numberFormat": "0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "integer",
                    "displayAs": "number",
                    "visible": true,
                    "order": 7,
                    "title": "commands",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "commands"
                  },
                  {
                    "fieldName": "sql_commands",
                    "numberFormat": "0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "integer",
                    "displayAs": "number",
                    "visible": true,
                    "order": 8,
                    "title": "sql commands",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "sql_commands"
                  },
                  {
                    "fieldName": "workspace_id",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 9,
                    "title": "workspace_id",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "workspace_id"
                  }
                ]
              },
              "invisibleColumns": [
                {
                  "booleanValues": [
                    "false",
                    "true"
                  ],
                  "imageUrlTemplate": "{{ @ }}",
                  "imageTitleTemplate": "{{ @ }}",
                  "imageWidth": "",
                  "imageHeight": "",
                  "linkUrlTemplate": "{{ @ }}",
                  "linkTextTemplate": "{{ @ }}",
                  "linkTitleTemplate": "{{ @ }}",
                  "linkOpenInNewTab": true,
                  "name": "interactive_dollar_dbus",
                  "type": "decimal",
                  "displayAs": "number",
                  "order": 100010,
                  "title": "interactive_dollar_dbus",
                  "allowSearch": false,
                  "alignContent": "right",
                  "allowHTML": false,
                  "highlightLinks": false,
                  "useMonospaceFont": false,
                  "preserveWhitespace": false
                },
                {
                  "booleanValues": [
                    "false",
                    "true"
                  ],
                  "imageUrlTemplate": "{{ @ }}",
                  "imageTitleTemplate": "{{ @ }}",
                  "imageWidth": "",
                  "imageHeight": "",
                  "linkUrlTemplate": "{{ @ }}",
                  "linkTextTemplate": "{{ @ }}",
                  "linkTitleTemplate": "{{ @ }}",
                  "linkOpenInNewTab": true,
                  "name": "dbsql_dollar_dbus",
                  "type": "decimal",
                  "displayAs": "number",
                  "order": 100011,
                  "title": "dbsql_dollar_dbus",
                  "allowSearch": false,
                  "alignContent": "right",
                  "allowHTML": false,
                  "highlightLinks": false,
                  "useMonospaceFont": false,
                  "preserveWhitespace": false
                }
              ],
              "allowHTMLByDefault": false,
              "itemsPerPage": 50,
              "paginationSize": "default",
              "condensed": true,
              "withRowNumber": false,
              "frame": {
                "showTitle": true,
                "title": "Interactive Clusters running mostly SQL workloads over last 30 days",
                "showDescription": false
              }
            }
          },
          "position": {
            "x": 0,
            "y": 6,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "4f386fe7",
            "textbox_spec": "# Better SQL for Customers\nThis Dashboard will help identify high SQL usage for Interactive clusters, which is an anti-pattern. These SQL workloads would be better served via the specialized DBSQL Warehouse endpoints.\n![Move to the right](https://github.com/user-attachments/assets/6978e97a-d76e-4949-bcbf-ff7c45b04276)\n\n- Deploy this Lakeview dashboard to customer's account.\n\n- Ensure system schemas (system.access, system.billing, and system.compute.*) [are enabled and accessible ](https://docs.databricks.com/en/admin/system-tables/index.html#enable-a-system-schema)\n"
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "3d782f30",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "20d751a8",
                  "fields": [
                    {
                      "name": "usage_quantity",
                      "expression": "`usage_quantity`"
                    },
                    {
                      "name": "user_agent",
                      "expression": "`user_agent`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "clusterId",
                      "expression": "`clusterId`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 1,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "usage_quantity",
                    "numberFormat": "0,000.0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "decimal",
                    "displayAs": "number",
                    "visible": true,
                    "order": 0,
                    "title": "DBUs",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "usage_quantity"
                  },
                  {
                    "fieldName": "user_agent",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 2,
                    "title": "user_agent",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "user_agent"
                  },
                  {
                    "fieldName": "cluster_name",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 3,
                    "title": "cluster_name",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": true,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "cluster_name"
                  },
                  {
                    "fieldName": "clusterId",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 4,
                    "title": "clusterId",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "clusterId"
                  }
                ]
              },
              "invisibleColumns": [
                {
                  "numberFormat": "0",
                  "booleanValues": [
                    "false",
                    "true"
                  ],
                  "imageUrlTemplate": "{{ @ }}",
                  "imageTitleTemplate": "{{ @ }}",
                  "imageWidth": "",
                  "imageHeight": "",
                  "linkUrlTemplate": "{{ @ }}",
                  "linkTextTemplate": "{{ @ }}",
                  "linkTitleTemplate": "{{ @ }}",
                  "linkOpenInNewTab": true,
                  "name": "count",
                  "type": "integer",
                  "displayAs": "number",
                  "order": 1,
                  "title": "count",
                  "allowSearch": false,
                  "alignContent": "right",
                  "allowHTML": false,
                  "highlightLinks": false,
                  "useMonospaceFont": false,
                  "preserveWhitespace": false
                }
              ],
              "allowHTMLByDefault": false,
              "itemsPerPage": 25,
              "paginationSize": "default",
              "condensed": true,
              "withRowNumber": false,
              "frame": {
                "showTitle": true,
                "title": "BI Tools attached to Interactive Clusters"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 41,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "58eb0bc7",
            "textbox_spec": "## SQL Notebooks should be pointed to DBSQL Warehouses \nThis leads to better experience, better performance and better TCO"
          },
          "position": {
            "x": 0,
            "y": 25,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "9a6cebe3",
            "textbox_spec": "## Identify Clusters and BI tools in use with Interactive clusters.\nBI Tools are better served with DBSQL\n- Faster start time\n- Lower Idle time\n- Lower infrastructure costs\n\nIt's easy to connect BI tools to DBSQL Warehouses:\n1. Provision a (Serverless) DBSQL Warehouse if needed\n2. Change your BI tool connection \n   - [Power BI](https://docs.databricks.com/en/partners/bi/power-bi.html)\n   - [Tableau](https://docs.databricks.com/en/partners/bi/tableau.html)\n   - [via Partner Connect](https://docs.databricks.com/en/integrations/index.html#bi)\n   - [Connection details](https://docs.databricks.com/en/integrations/compute-details.html)\n"
          },
          "position": {
            "x": 0,
            "y": 35,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "28db7ef3",
            "queries": [
              {
                "name": "parameter_dashboards/01ef4521112e1f2cba0654b40076a639/datasets/01ef4522e5c41eb69779a94b43048ea1_interactive_dbu_cost",
                "query": {
                  "datasetName": "30567c7e",
                  "parameters": [
                    {
                      "name": "interactive_dbu_cost",
                      "keyword": "interactive_dbu_cost"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "filter-single-select",
              "encodings": {
                "fields": [
                  {
                    "parameterName": "interactive_dbu_cost",
                    "queryName": "parameter_dashboards/01ef4521112e1f2cba0654b40076a639/datasets/01ef4522e5c41eb69779a94b43048ea1_interactive_dbu_cost"
                  }
                ]
              },
              "selection": {
                "defaultSelection": {
                  "values": {
                    "dataType": "STRING",
                    "values": [
                      {
                        "value": "1.3"
                      }
                    ]
                  }
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Interactive SQL $",
                "showDescription": true,
                "description": "All inclusive Interactive All Purpose Cluster SQL $/hr"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 15,
            "width": 3,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "aa1e9643",
            "queries": [
              {
                "name": "parameter_dashboards/01ef4521112e1f2cba0654b40076a639/datasets/01ef4522e5c41eb69779a94b43048ea1_dbsql_cost",
                "query": {
                  "datasetName": "30567c7e",
                  "parameters": [
                    {
                      "name": "dbsql_cost",
                      "keyword": "dbsql_cost"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "filter-single-select",
              "encodings": {
                "fields": [
                  {
                    "parameterName": "dbsql_cost",
                    "queryName": "parameter_dashboards/01ef4521112e1f2cba0654b40076a639/datasets/01ef4522e5c41eb69779a94b43048ea1_dbsql_cost"
                  }
                ]
              },
              "selection": {
                "defaultSelection": {
                  "values": {
                    "dataType": "STRING",
                    "values": [
                      {
                        "value": "0.40"
                      }
                    ]
                  }
                }
              },
              "frame": {
                "showTitle": true,
                "title": "DBSQL cost $",
                "showDescription": true,
                "description": "All inclusive DBSQL cost"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 15,
            "width": 3,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "bab8bc8b",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "30567c7e",
                  "fields": [
                    {
                      "name": "clusterId",
                      "expression": "`clusterId`"
                    },
                    {
                      "name": "interactive_dollar_dbus",
                      "expression": "`interactive_dollar_dbus`"
                    },
                    {
                      "name": "dbsql_dollar_dbus",
                      "expression": "`dbsql_dollar_dbus`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "clusterId",
                  "scale": {
                    "type": "categorical",
                    "sort": {
                      "by": "y-reversed"
                    }
                  },
                  "displayName": "Cluster"
                },
                "y": {
                  "fields": [
                    {
                      "fieldName": "interactive_dollar_dbus",
                      "displayName": "Interactive $DBUs"
                    },
                    {
                      "fieldName": "dbsql_dollar_dbus",
                      "displayName": "DBSQL $DBUs"
                    }
                  ],
                  "scale": {
                    "type": "quantitative"
                  }
                }
              },
              "frame": {
                "showDescription": false,
                "title": "Table of sql_clusters data",
                "showTitle": true
              },
              "mark": {
                "layout": "group"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 17,
            "width": 6,
            "height": 8
          }
        },
        {
          "widget": {
            "name": "2e1d88bf",
            "textbox_spec": "## Compare costs between Interactive SQL and DBSQL\nProvide rough estimate of cost differential between Interactive SQL (All purpose clusters) and DBSQL\n- Calculate off line $/DBU for Interactive SQL, include Cloud VM costs, network,...\n- Calculate DBSQL costs, Serverless DBSQL is one list (or discounted) price."
          },
          "position": {
            "x": 0,
            "y": 12,
            "width": 6,
            "height": 3
          }
        }
      ]
    }
  ]
}